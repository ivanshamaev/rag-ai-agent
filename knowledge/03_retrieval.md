# Методы retrieval: Dense vs Sparse и гибридные подходы

Retrieval — процесс поиска релевантных документов/фрагментов для подстановки в генеративные модели.

## Sparse retrieval (разреженный)

- Основан на терминах (bag-of-words): классические индексы типа inverted index, BM25.
- Преимущества: быстрый поиск, объяснимость, хорошо работает при точных термах.
- Ограничения: слабая семантика, чувствительность к синонимам.

## Dense retrieval (плотный)

- Использует эмбеддинги (векторы) и nearest-neighbor поиск (ANN).
- Преимущества: лучшая семантическая релевантность, устойчив к перефразированиям.
- Ограничения: требует векторной БД/индексов, дорогой подбор и обновление.

## Гибридные подходы

- Комбинация sparse + dense: сначала фильтрация BM25, затем rerank по косинусу или объединение скорингов.
- Часто даёт лучшее соотношение latency/качество и устойчивость к длинным коллекциям.

## Архитектуры и практики

- ANN-библиотеки: FAISS, Annoy, HNSW (используется в Milvus, Qdrant).
- Функции: recall-oriented recall@k, precision@k, latency-budgeting.

## Пояснение для новичка: базовые термины

- **Retriever**: часть системы, которая по вашему запросу (вопросу) находит похожие документы или фрагменты.
- **Sparse (разреженный) поиск**: ищет совпадения по словам и их частоте (напоминает полнотекстовый поиск): хорошо, если запрос содержит ключевые термины.
- **Dense (плотный) поиск**: ищет по смыслу, используя эмбеддинги — полезен, если вы перефразировали вопрос.
- **Hybrid (гибридный)**: комбинация двух подходов, чтобы использовать преимущества обоих.

Простой пример: запрос "как сделать кофе" — sparse найдет документы с точным словосочетанием, dense — найдет статьи с рецептом кофе даже если там используется "приготовить эспрессо".
